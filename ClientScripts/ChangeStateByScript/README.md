# ChangeState

Этот каталог содержит пример изменения состояния карточки.
Проверить доступность перехода по Ролевой модели и, если разрешено, выполнить изменение состояния карточки.
Если переход не разрешен, выдать предупреждающее сообщение. 

## Настройка среды

**Перечень необходимых инструментов:** 
* [Visual Studio 2017](https://www.visualstudio.com)
* [TypeScript 2.5](https://www.typescriptlang.org)
* Включенные в **Visual Studio** опции  [NuGet Package Restore](https://docs.microsoft.com/en-us/nuget/consume-packages/package-restore#enabling-and-disabling-package-restore)

## Сборка и установка

1. Открыть /Samples.sln
2. Собрать проект ClientScripts > ChangeStateByScript > ChangeStateByScriptWebExtension
3. Скопировать каталог SamplesOutput\Site\Content\Extensions\ChangeStateByScript в каталог "Путь к установленному Web-клиент\Site\Content\Extensions"
4. Перезапустить IIS

## Проверка примера

1. Запустить конструктор разметок
2. Импортировать разметку из файла ChangeStateByScriptLayout.xml без условий использования. При этом будет добавлена разметка в тип карточки документ, вид ДокументУД\Исходящий
3. Задать для разметки условия использования, поменяв также порядок разметок в условиях использования, чтобы разметка стала первой разметкой для редактирования 
4. Перезапустить IIS
5. Открыть новый документ ДокументУД\Исходящий и нажать кнопку редактировать. При этом должна открыться разметка с кнопкой изменения состояния. 
6. При нажатии на кнопку изменения состояния проверяется доступность операции Start approving (переход из состояния Drafting на состояние Is approving).
Если операция доступна, то выполняется изменение состояние и отображается сообщение, что состояние изменено. 
Иначе отображается сообщение, что операция не доступна. 
(Операция Start approving с идентификатором 'b8a6119c-4d06-4401-b1af-0310615c72f6' определена для вида ДокументУД\Исходящий,
 для другого вида значение идентификатора операции может отличаться).

## Проект ChangeStateByScriptWebExtension

Проект-расширение клиентской части Web-клиент. Содержит клиентский скрипт c функцией changeStateByScript реализующей изменение состояния.

Внимание! Данный пример демонстрирует только изменение состояния карточки с помощью скрипта. 
При реализации расширений рекомендуется использовать экспорт разметок в виде Решения.