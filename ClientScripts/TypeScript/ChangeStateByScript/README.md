# ChangeState

Этот каталог содержит пример изменения состояния карточки.
Проверить доступность перехода по Ролевой модели и, если разрешено, выполнить изменение состояния карточки.
Если переход не разрешен, выдать предупреждающее сообщение. 

## Настройка среды

**Перечень необходимых инструментов:** 
* [NodeJS v14.17.0+](https://nodejs.org/en/)

## Сборка и установка

1. Открыть консоль в папке ChangeStateByScriptWebExtension и выполнить команду npm install, потом  npm update и в конце npm run build:prod
2. Скопировать каталог SamplesOutput\Site\Content\Modules\ChangeStateByScriptWebExtension в каталог "Путь к установленному Web-клиент\Site\Content\Modules"
3. Перезапустить IIS

## Проверка примера

1. Запустить конструктор разметок
2. Импортировать решение из файла ChangeStateByScriptLayout.xml
3. Сделать решение ChangeStateByScriptLayout активным для карточки типа Документ вида ДокументУД/Исходящий
4. Перезапустить IIS
5. Открыть новый документ ДокументУД\Исходящий и нажать кнопку редактировать. При этом должна открыться разметка с кнопкой изменения состояния. 
6. При нажатии на кнопку изменения состояния проверяется доступность операции Start approving (переход из состояния Drafting на состояние Is approving).
Если операция доступна, то выполняется изменение состояние и отображается сообщение, что состояние изменено. 
Иначе отображается сообщение, что операция не доступна. 
(Операция Start approving с идентификатором 'b8a6119c-4d06-4401-b1af-0310615c72f6' определена для вида ДокументУД\Исходящий,
 для другого вида значение идентификатора операции может отличаться).

## Проект ChangeStateByScriptWebExtension

Проект-расширение клиентской части Web-клиент. Содержит клиентский скрипт c функцией changeStateByScript реализующей изменение состояния.

Внимание! Данный пример демонстрирует только изменение состояния карточки с помощью скрипта. 
При реализации расширений рекомендуется использовать экспорт разметок в виде Решения.