# ValidateOnStateChanging

Этот каталог содержит пример валидации, изменения и отмены изменения состояния карточки.
Подписаться на событие изменения состояния, провести валидацию какого-нибудь поля и случае, если валидация не прошла, 
выдать предупреждающее сообщение и состояние не менять.

## Настройка среды

**Перечень необходимых инструментов:** 
* [NodeJS v12.16.1+](https://nodejs.org/en/)

## Сборка и установка

1. Открыть консоль в папке ValidateOnStateChangingWebExtension и выполнить команду npm install, потом  npm update и в конце npm run build:prod
2. Скопировать каталог SamplesOutput\Site\Content\Modules\ValidateOnStateChangingWebExtension в каталог "Путь к установленному Web-клиент\Site\Content\Modules"
3. Перезапустить IIS

## Проверка примера

1. Запустить конструктор разметок
2. Импортировать решение из файла ValidateOnStateChangingLayout.xml 
3. Сделать решение ValidateOnStateChangingLayout активным для карточки типа Документ вида ДокументУД/Исходящий
4. На разметке расположен textBox и кнопки операций (Start approving и др.) по изменению состояния карточки
5. Перезапустить IIS
6. Открыть новый документ ДокументУД\Исходящий и нажать кнопку редактировать. При этом должна открыться разметка с textBox и кнопками изменения состояния. 
(Часть кнопок будет неактивна, это зависит от настроек ролевой модели.)
7. Если в textBox нет текста или длина текста превышает 100 символов, то при нажатии на кнопку изменения состояния возникает сообщение об ошибке и состояние не изменяется.
В случае, если textBox проходит валидацию, то состояние карточки меняется (например при выполнении операции Start approving с состояния Drafting на состояние Is approving). 
При этом  кнопки перехода исчезают, т.к. в состоянии Is approving операции Start approving и др. не доступны.

## Проект ValidateOnStateChangingWebExtension

Проект-расширение клиентской части Web-клиент. Содержит клиентский скрипт c функцией-обработчиком события validateOnStateChanging, реализующей валидацию данных контрола
 при смене состояния.

Внимание! Данный пример демонстрирует только доступ к элементу разметки. 
При реализации расширений рекомендуется использовать экспорт разметок в виде Решения.