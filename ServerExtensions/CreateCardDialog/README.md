# CreateCardDialog

Этот пример добавления в диалог создания карточки пользовательского типа.

## Настройка среды

**Перечень необходимых инструментов:** 
* [Visual Studio 2017/2019](https://www.visualstudio.com)
* [NodeJS v14.17.0+](https://nodejs.org/en/)

## Сборка

1. Открыть /Samples.sln
2. Собрать проект ServerExtensions > CreateCardDialog > CreateCardDialogServerExtension
3. Открыть консоль в папке ServerExtensions > CreateCardDialog > CreateCardDialogWebExtension и выполнить команду npm install, потом  npm update и в конце npm run build:prod
4. Скопировать каталог SamplesOutput\Site\Extensions\CreateCardDialogServerExtension в каталог "Путь к установленному Web-клиент\Site\Extensions"
5. Скопировать файл SamplesOutput\Site\Extensions\ru\CreateCardDialogServerExtension.resources.dll в каталог "Путь к установленному Web-клиент\Site\Extensions\ru"
6. Скопировать каталог SamplesOutput\Site\Content\Modules\CreateCardDialogWebExtension в каталог "Путь к установленному Web-клиент\Site\Content\Modules"
7. Перезапустить IIS

## Проверка примера

1. Запустить конструктор разметок
2. Выбрать библиотеку "ApprovalDesigner карточки"
3. Выбрать тип "Этап согласования"
4. Создать разметку создания и просмотра (Например, добавить элемент управления "Строка" и привязать его к свойству "MainInfo\Name")
5. Выбрать условия использования этих разметок
6. В конфигурационном файле Web-клиент Web.config в секции Docsvision > Platform > CardTypes добавить строку: 
```xml
	<CardType CardTypeId="0DB13C90-21B6-49D8-9070-8144DF97552A" CssClass="approval-stage"/>
```
где "0DB13C90-21B6-49D8-9070-8144DF97552A" - идентификатор типа карточки этапа согласования  

7. Разрешить создание карточек вида "Этап согласования" в справочнике видов карточек.
8. Перезапустить IIS
9. Открыть ЛК и нажать на кнопку "Создать"
10. Должен появиться новый тип карточки "Этап", доступный для создания (фон - фиолетовый).
11. При выборе его, открывается созданная разметка, при этом фон боковой панели и шапки становится фиолетовым.

## Проект CreateCardDialogServerExtension

Проект реализует серверное расширение, в котором регистрируется фабрика для создания типа карточки "Этап", отличная от стандартной. 

## Проект CreateCardDialogWebExtension

Содержит клиентские скрипты реализующие вебное расширение, которое регистрирует тип карточки для его корректного отображения в вебном клиенте.

## Пояснения

В простейшем варианте, для подключения нового типа карточки к веб клиенту, достаточно выполнить п.6 из инструкции проверки примера, а так же описать стиль класса approval-stage-color, например как:
.approval-stage-color {
    background-color: black;
}
Этот стиль применяется к элементам добавляемого типа карточки в диалоге создания карточки.

В случае, если необходимо изменять цвет основных элементов управления веб клиента (Основная кнопка, шапка, боковые панели), то следует реализовать вебное расширение (см. файл LayoutExtension.ts) и стили (см. approval-stage.scss). Необходимо отметить, что локализованные наименования всех зарегистрированных типов карточек доступны на клиенте и содержатся в объекте resources. Наименование пользовательского типа доступно по ключу CardType_{CardTypeName}_DisplayName,
где {CardTypeName} - наименование типа карточки в файле метаданных. 

В собственном решении / элементе управления возможно использовать цвета, связанные с каким-то типом карточки. Для этого следует воспользоваться системными css классами:
.card-type-background-color - стандартный фон элемента типа карточки
.card-type-background-color-hover - стандартный фон элемента типа карточки при наведение мыши
.card-type-background-color-light - светлый фон элемента типа карточки
.card-type-background-color-light-hover - светлый фон элемента типа карточки при наведении мыши
.card-type-background-color-disabled - заблокированный фон элемента типа карточки (например, когда кнопка недоступна для нажатия) 
.card-type-foreground-color - стандартный цвет шрифта типа карточки

Список может быть расширен, подробности содержатся в документации разработчика.

В случае, если реализована или необходимо реализовать определенную бизнесс логики при создании карточки (например, задать значение какого-то поля по умолчанию), то можно подключить серверное расширение и реализовать в нем интерфейс ICardFactory, в котором реализуется собственная логика по созданию карточки / созданию карточки по шаблону.