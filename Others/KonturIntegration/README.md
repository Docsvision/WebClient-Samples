# KonturIntegration

Данный пример демонстрирует возможность интеграции с сервисом Контур.Фокус.

## Описание примера

Пример включает два компонента:

- KonturServerExtension – папка с серверным расширением Web-клиента, в котором реализовано проксирование запросов к Контур.Фокус (для обхода ограничений CORS в браузере).
- KonturWebExtension – папка с клиентским расширением, в котором реализовано открытие отчета о контрагенте и загрузка информации.
- KonturSolution.xml - решение с разметкой для организации контрагента, содержащее разметку с необходимыми обработчиками и контролами.

## Настройка среды

Пример рассчитан на версию Web-клиента 18 (6.1) или выше.

**Перечень необходимых инструментов:** 
* [Visual Studio 2022](https://www.visualstudio.com)
* [NodeJS v16.20.0+](https://nodejs.org/en/)

## Сборка проекта

1. Сборка серверной части.
   1. Откройте решение Samples.sln
   2. Соберите проект Other > Kontur > Kontur

2. Сборка клиентской части.
   1. Откройте в командной строке папку Others > KonturIntergration > KonturWebExtension.

   2. Выполните команды:

      ```
      npm install
      npm update
      npm run build:prod
      ```

3. Публикация компонентов на сервере Web-клиент.

   1. Скопируйте папку `SamplesOutput\Site\Content\Modules\KonturWebExtension\` в  `Путь к сайту Web-клиента\Content\Modules`.
   2. Скопируйте папку `SamplesOutput\Site\Extensions\KonturServerExtension` в  `Путь к сайту Web-клиента\Extensions`.
   3. Перезапустите Web-сервис.

## Проверка примера

### При создании контрагента

1. В Конструкторе web-разметок импортируйте решение KonturSolution.xml.

2. В appsettings.json Web-клиента добавьте в корневой элемент настройку с ключом доступа к API Контур.Фокус.

    "KonturSettings": {
        "ApiKey": "..."
    }

3. Зайдите на разметку с контролом PartnerDepartment (например, создание исходящего документа), откройте окно справочника и нажмите кнопку добавления организации.

4. В открывшейся разметке введите ИНН организации (например, 6663003127)

5. Нажмите кнопку "Просмотреть отчет о контрагенте" - откроется окно с информацией о контрагенте.

6. Нажимите на кнопку "Загрузить информацию" - значения элементов управления на разметке заполнятся данными из Контур.Фокус.

### В карточке документа

1. Добавьте разметку карточки типа документ кнопку, назначьте ей обработчик openBriefReportAndAttachFile

2. В ту же разметку добавьте контрол с именем INN типа TextBox. Настройте его таким образом, что бы он содержал актуальный INN контрагента (например, через расширенные источники данных).

3. Откройте документ и нажмите на кнопку - откроется отчет в модальном окне и к документу будет прикреплен файл отчета в качестве дополнительного файла.

