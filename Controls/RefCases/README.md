# RefCases

Данный пример демонстрирует возможность разработки элемента управления для выбора и отображения Дела из Справочника номенклатуры дел 5.

## Описание примера

Пример включает три компонента:

- RefCasesDesignerExtension – папка с расширение Конструктора web-разметок и текстовым описателем элемента управления. Расширение добавляет редактор для выбора поля карточки, связанного с секцией Дела справочника, а также редактор для свойства, выбирающего корневой раздел справочника, из которого разрешено выбирать дела.
- RefCasesServerExtension – папка с серверным расширением Web-клиента, в котором реализованы веб-методы доступа к данным Справочника номенклатуры дел 5.
- RefCasesWebExtension – папка с клиентским расширением, в котором реализован клиентский компонент элемента управления RefCases.

## Настройка среды разработки

**Перечень необходимых инструментов:** 
* [Visual Studio 2017/2019](https://www.visualstudio.com)
* [NodeJS v14.17.0+](https://nodejs.org/en/)

## Сборка проекта

1. Сборка расширения Конструктора web-разметок и серверного расширения.
   1. Откройте решение Samples.sln.
   2. Соберите проект Controls > RefCases > RefCasesDesignerExtension.
3. Соберите проект Controls > RefCases > RefCasesServerExtension.
   
2. Сборка клиентской части.
   1. Откройте в командной строке папку Controls > RefCases > RefCasesWebExtension\.

   2. Выполните команды:

      ```
      npm install
      npm update
      npm run build:prod
      ```

3. Публикация компонентов на сервере Web-клиент.

   1. Скопируйте папку `SamplesOutput\Plugins\RefCasesDesignerExtension\` в  `<Каталог установки Web-клиента>\Plugins`.
   2. Скопируйте папки `SamplesOutput\Site\Extensions\RefCasesServerExtension\` и `SamplesOutput\Site\Extensions\ru\` в  `<Каталог установки Web-клиента>\Site\Extensions`.
   3. Скопируйте папку `SamplesOutput\Site\Content\Modules\RefCasesWebExtension\` в  `<Каталог установки Web-клиента>\Site\Content\Modules`.
   4. Перезапустите IIS.

## Проверка примера

1. В Docsvision должен быть установлен модуль «Docsvision 5. Делопроизводство 5».

2. С помощью Конструктора разметок Docsvision добавьте в метаданные карточки Документ расширенное поле, ссылающееся на секцию «Дела» Справочника номенклатуры дел 5.

   >  Данный шаг не является обязательным – можно использовать стандартное поле «Основная информация / Идентификатор дела», но при этом потребуется изменить редактор `RefCasesFieldMetadataEditor`, т. к. поле «Идентификатор дела» не содержит метаданных, указывающих на секцию «Дела» Справочника номенклатуры дел 5, что не даст возможность выбрать данное поле с использованием стандартной реализации редактора `RefCasesFieldMetadataEditor`. Инструкция по необходимой модификации приведена в руководстве программиста Web-клиента, пункт «Создание описателя элемента управления и расширения Конструктора web-разметок» (комментарий к разработке редактора RefCasesFieldMetadataEditor).

3. В Конструкторе web-разметок добавьте элемент **Справочник номенклатуры дел 5 (RefCases)** в разметку редактирования карточки Документ.

4. В настройках источника элемента управления выберите поле карточки, добавленное на шаге 2.

5. Если требуется, выберите корневой раздел в свойстве «Раздел».

6. Сохраните разметку.

7. Откройте любую карточку с данной настроенной разметкой.

8. Если выбранное поле уже содержит ссылку на Дело, будет показано его название (дополняется годом и разделом).

   Нажмите кнопку выбора из справочника и выберите Год, Раздел и Дело. Нажмите кнопку «Выбрать». Дело будет указано в основном поле элемента управления.

   Воспользуйтесь быстрым поиском по справочнику. Быстрый поиск должен показать результаты, если дела с указанным названием есть в справочнике. Обратите внимание, что поиск выполняется по названию, но в поле вписывается название, а также год и раздел справочника.
